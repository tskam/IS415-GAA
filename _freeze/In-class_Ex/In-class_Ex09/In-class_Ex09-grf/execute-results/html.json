{
  "hash": "12e1ae3efbe9a60361e2d1bbcb8ec160",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Geographically Weighted Predictive Models: Geographical Random Forest (grf) methods\"\ndate: \"March 9, 2024\"\ndate-modified: \"last-modified\"\nformat: html\nexecute:\n  echo: true\n  eval: true\n  warning: false\n  freeze: true\n---\n\n\n## Learning outcome\n\nIn this in-class exercise, you will learn how to build predictive model by using geographical random forest method. By the end of this hands-on exercise, you will acquire the skills of:\n\n-   preparing training and test data sets by using appropriate data sampling methods,\n-   calibrating predictive models by using both geospatial statistical learning and machine learning methods,\n-   comparing and selecting the best model for predicting the future outcome,\n-   predicting the future outcomes by using the best model calibrated.\n\n## Installing and Loading R packages\n\nThis code chunk performs 3 tasks:\n\n-   A list called packages will be created and will consists of all the R packages required to accomplish this exercise.\n-   Check if R packages on package have been installed in R and if not, they will be installed.\n-   After all the R packages have been installed, they will be loaded.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, spdep, GWmodel,\n               SpatialML, tmap, \n               tidymodels, tidyverse, \n               gtsummary,\n               rpart, rpart.plot, \n               ggstatsplot, performance)\n```\n:::\n\n\n## The Data\n\n### Reading data file to rds\n\nReading the input data sets. It is in simple feature data frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrs_sf <- read_rds(\"data/rds/HDB_resale.rds\")\n```\n:::\n\n\nNext, the code chunk below is used to reveal the properties of *rs_sf* object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrs_sf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 15901 features and 17 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 11597.31 ymin: 28217.39 xmax: 42623.63 ymax: 48741.06\nProjected CRS: SVY21 / Singapore TM\n# A tibble: 15,901 × 18\n   RESALE_PRICE FLOOR_AREA_SQM STOREY_ORDER REMAINING_LEASE_MTHS PROX_CBD\n          <dbl>          <dbl>        <int>                <dbl>    <dbl>\n 1       330000             92            1                  684     8.82\n 2       360000             91            3                  738     9.84\n 3       370000             92            1                  733     9.56\n 4       375000             99            2                  700     9.61\n 5       380000             92            2                  715     8.35\n 6       380000             92            4                  732     9.49\n 7       385000             92            3                  706     8.96\n 8       395000             92            2                  745     9.81\n 9       395000             93            4                  731    10.3 \n10       395000             91            3                  725    10.4 \n# ℹ 15,891 more rows\n# ℹ 13 more variables: PROX_ELDERLYCARE <dbl>, PROX_HAWKER <dbl>,\n#   PROX_MRT <dbl>, PROX_PARK <dbl>, PROX_GOOD_PRISCH <dbl>, PROX_MALL <dbl>,\n#   PROX_CHAS <dbl>, PROX_SUPERMARKET <dbl>, WITHIN_350M_KINDERGARTEN <int>,\n#   WITHIN_350M_CHILDCARE <int>, WITHIN_350M_BUS <int>,\n#   WITHIN_1KM_PRISCH <int>, geometry <POINT [m]>\n```\n\n\n:::\n:::\n\n\nNotice that it is a sf tibble data.frame. The are a total of 15901 observation and 18 columns (i.e. variables) including the geometry column.\n\n### Data Sampling\n\nFor predictive modelling, we need to have at least two sets of data, one to train the algorithm and the other one will be used for model comparison.\n\n::: panel-tabset\n## The task\n\nSplit *rs_sf* into training and test data sets into with 50% and 50% respectively by using appropriate function of **rsample** package.\n\n## The code chunk\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\nresale_split <- initial_split(\n  rs_sf, \n  prop = 5/10,)\ntrain_sf <- training(resale_split)\ntest_sf <- testing(resale_split)\n```\n:::\n\n:::\n\n### Converting from sf objects to data.frame gwModel and spatial ML libraries require the input data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_df <- train_sf %>%\n  st_drop_geometry() %>%\n  as.data.frame()\n\ntest_df <- test_sf %>%\n  st_drop_geometry() %>%\n  as.data.frame()\n```\n:::\n\n\n### Saving the output files\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(train_df, \"data/rds/train_df.rds\")\nwrite_rds(test_df, \"data/rds/test_df.rds\")\n```\n:::\n\n\n## Retriving the Stored Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_df <- read_rds(\"data/rds/train_df.rds\")\ntest_df <- read_rds(\"data/rds/test_df.rds\")\n```\n:::\n\n\n## Computing Correlation Matrix\n\nBefore loading the predictors into a predictive model, it is always a good practice to use correlation matrix to examine if there is sign of multicolinearity.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrs_sf1 <- rs_sf %>%\n  st_drop_geometry()\nggcorrmat(rs_sf1[, 2:17]) \n```\n\n::: {.cell-output-display}\n![](In-class_Ex09-grf_files/figure-html/unnamed-chunk-8-1.png){width=1152}\n:::\n:::\n\n\n::: callout-note\nThe correlation matrix above shows that all the correlation values are below 0.8. Hence, there is no sign of multicolinearity.\n:::\n\n## Building a Non-spatial Multiple Linear Regression\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrs_mlr <- lm(formula = RESALE_PRICE ~ \n               FLOOR_AREA_SQM +\n               STOREY_ORDER +\n               REMAINING_LEASE_MTHS +\n               PROX_CBD + \n               PROX_ELDERLYCARE + \n               PROX_HAWKER +\n               PROX_MRT + \n               PROX_PARK + \n               PROX_GOOD_PRISCH +\n               PROX_MALL + \n               PROX_CHAS +\n               PROX_SUPERMARKET +\n               WITHIN_350M_KINDERGARTEN +\n               WITHIN_350M_CHILDCARE +\n               WITHIN_350M_BUS +\n               WITHIN_1KM_PRISCH,\n             data=train_df)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntbl_regression(rs_mlr, \n               intercept = TRUE) %>% \n  add_glance_source_note(\n    label = list(sigma ~ \"\\U03C3\"),\n    include = c(r.squared, adj.r.squared, \n                AIC, statistic,\n                p.value, sigma))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"picinvvobf\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#picinvvobf table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#picinvvobf thead, #picinvvobf tbody, #picinvvobf tfoot, #picinvvobf tr, #picinvvobf td, #picinvvobf th {\n  border-style: none;\n}\n\n#picinvvobf p {\n  margin: 0;\n  padding: 0;\n}\n\n#picinvvobf .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#picinvvobf .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#picinvvobf .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#picinvvobf .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#picinvvobf .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#picinvvobf .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#picinvvobf .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#picinvvobf .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#picinvvobf .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#picinvvobf .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#picinvvobf .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#picinvvobf .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#picinvvobf .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#picinvvobf .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#picinvvobf .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#picinvvobf .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#picinvvobf .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#picinvvobf .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#picinvvobf .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#picinvvobf .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#picinvvobf .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#picinvvobf .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#picinvvobf .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#picinvvobf .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#picinvvobf .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#picinvvobf .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#picinvvobf .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#picinvvobf .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#picinvvobf .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#picinvvobf .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#picinvvobf .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#picinvvobf .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#picinvvobf .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#picinvvobf .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#picinvvobf .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#picinvvobf .gt_left {\n  text-align: left;\n}\n\n#picinvvobf .gt_center {\n  text-align: center;\n}\n\n#picinvvobf .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#picinvvobf .gt_font_normal {\n  font-weight: normal;\n}\n\n#picinvvobf .gt_font_bold {\n  font-weight: bold;\n}\n\n#picinvvobf .gt_font_italic {\n  font-style: italic;\n}\n\n#picinvvobf .gt_super {\n  font-size: 65%;\n}\n\n#picinvvobf .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#picinvvobf .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#picinvvobf .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#picinvvobf .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#picinvvobf .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#picinvvobf .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#picinvvobf .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;Characteristic&lt;/strong&gt;\"><strong>Characteristic</strong></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;Beta&lt;/strong&gt;\"><strong>Beta</strong></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;95% CI&lt;/strong&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><strong>95% CI</strong><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;p-value&lt;/strong&gt;\"><strong>p-value</strong></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">(Intercept)</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">105,360</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">81,898, 128,823</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">FLOOR_AREA_SQM</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">2,803</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">2,601, 3,005</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">STOREY_ORDER</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">14,044</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">13,292, 14,796</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">REMAINING_LEASE_MTHS</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">345</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">335, 355</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_CBD</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-17,918</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-18,434, -17,403</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_ELDERLYCARE</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-14,469</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-16,672, -12,265</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_HAWKER</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-17,101</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-19,961, -14,240</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_MRT</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-31,603</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-35,448, -27,758</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_PARK</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-9,334</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-12,677, -5,992</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_GOOD_PRISCH</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">2,787</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">2,036, 3,539</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_MALL</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-12,320</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-16,777, -7,863</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_CHAS</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-9,057</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-23,168, 5,054</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.2</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_SUPERMARKET</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-25,758</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-35,671, -15,845</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">WITHIN_350M_KINDERGARTEN</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">8,707</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">7,297, 10,117</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">WITHIN_350M_CHILDCARE</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-4,537</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-5,317, -3,756</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">WITHIN_350M_BUS</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">1,067</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">573, 1,562</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">WITHIN_1KM_PRISCH</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-8,192</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-9,277, -7,108</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"4\">R² = 0.742; Adjusted R² = 0.742; AIC = 197,736; Statistic = 1,428; p-value = &lt;0.001; σ = 60,847</td>\n    </tr>\n  </tfoot>\n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"4\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span> CI = Confidence Interval</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np <- performance::check_collinearity(\n  rs_mlr)\nplot(p)\n```\n\n::: {.cell-output-display}\n![](In-class_Ex09-grf_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n### Revising mlr model\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_df <- train_df %>%\n  select(-c(PROX_CHAS))\ntrain_sf <- train_sf %>%\n  select(-c(PROX_CHAS))\ntest_df <- test_df %>%\n  select(-c(PROX_CHAS))\ntest_sf <- test_sf %>%\n  select(-c(PROX_CHAS))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(train_sf, \"data/rds/train_sf.rds\")\nwrite_rds(train_df, \"data/rds/train_df.rds\")\nwrite_rds(test_sf, \"data/rds/test_sf.rds\")\nwrite_rds(test_df, \"data/rds/test_df.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrs_mlr <- lm(formula = RESALE_PRICE ~ \n               FLOOR_AREA_SQM +\n               STOREY_ORDER +\n               REMAINING_LEASE_MTHS +\n               PROX_CBD + \n               PROX_ELDERLYCARE + \n               PROX_HAWKER +\n               PROX_MRT + \n               PROX_PARK + \n               PROX_GOOD_PRISCH +\n               PROX_MALL + \n               PROX_SUPERMARKET +\n               WITHIN_350M_KINDERGARTEN +\n               WITHIN_350M_CHILDCARE +\n               WITHIN_350M_BUS +\n               WITHIN_1KM_PRISCH,\n             data=train_df)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntbl_regression(rs_mlr, \n               intercept = TRUE) %>% \n  add_glance_source_note(\n    label = list(sigma ~ \"\\U03C3\"),\n    include = c(r.squared, adj.r.squared, \n                AIC, statistic,\n                p.value, sigma))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"vndsvgxiwx\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#vndsvgxiwx table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#vndsvgxiwx thead, #vndsvgxiwx tbody, #vndsvgxiwx tfoot, #vndsvgxiwx tr, #vndsvgxiwx td, #vndsvgxiwx th {\n  border-style: none;\n}\n\n#vndsvgxiwx p {\n  margin: 0;\n  padding: 0;\n}\n\n#vndsvgxiwx .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#vndsvgxiwx .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#vndsvgxiwx .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#vndsvgxiwx .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#vndsvgxiwx .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#vndsvgxiwx .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vndsvgxiwx .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#vndsvgxiwx .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#vndsvgxiwx .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#vndsvgxiwx .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#vndsvgxiwx .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#vndsvgxiwx .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#vndsvgxiwx .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#vndsvgxiwx .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#vndsvgxiwx .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#vndsvgxiwx .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#vndsvgxiwx .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#vndsvgxiwx .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#vndsvgxiwx .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vndsvgxiwx .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#vndsvgxiwx .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#vndsvgxiwx .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#vndsvgxiwx .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vndsvgxiwx .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#vndsvgxiwx .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#vndsvgxiwx .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vndsvgxiwx .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vndsvgxiwx .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#vndsvgxiwx .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vndsvgxiwx .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#vndsvgxiwx .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vndsvgxiwx .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#vndsvgxiwx .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vndsvgxiwx .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#vndsvgxiwx .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vndsvgxiwx .gt_left {\n  text-align: left;\n}\n\n#vndsvgxiwx .gt_center {\n  text-align: center;\n}\n\n#vndsvgxiwx .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#vndsvgxiwx .gt_font_normal {\n  font-weight: normal;\n}\n\n#vndsvgxiwx .gt_font_bold {\n  font-weight: bold;\n}\n\n#vndsvgxiwx .gt_font_italic {\n  font-style: italic;\n}\n\n#vndsvgxiwx .gt_super {\n  font-size: 65%;\n}\n\n#vndsvgxiwx .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#vndsvgxiwx .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#vndsvgxiwx .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#vndsvgxiwx .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#vndsvgxiwx .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#vndsvgxiwx .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#vndsvgxiwx .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;Characteristic&lt;/strong&gt;\"><strong>Characteristic</strong></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;Beta&lt;/strong&gt;\"><strong>Beta</strong></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;95% CI&lt;/strong&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><strong>95% CI</strong><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;p-value&lt;/strong&gt;\"><strong>p-value</strong></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">(Intercept)</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">105,081</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">81,622, 128,540</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">FLOOR_AREA_SQM</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">2,791</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">2,589, 2,992</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">STOREY_ORDER</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">14,038</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">13,286, 14,789</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">REMAINING_LEASE_MTHS</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">346</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">335, 356</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_CBD</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-17,907</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-18,422, -17,392</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_ELDERLYCARE</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-14,588</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-16,783, -12,392</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_HAWKER</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-17,434</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-20,247, -14,621</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_MRT</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-31,752</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-35,590, -27,914</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_PARK</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-9,366</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-12,708, -6,023</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_GOOD_PRISCH</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">2,758</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">2,008, 3,508</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_MALL</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-12,220</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-16,674, -7,765</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_SUPERMARKET</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-28,049</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-37,298, -18,800</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">WITHIN_350M_KINDERGARTEN</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">8,722</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">7,312, 10,131</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">WITHIN_350M_CHILDCARE</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-4,515</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-5,295, -3,735</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">WITHIN_350M_BUS</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">1,084</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">590, 1,578</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">WITHIN_1KM_PRISCH</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-8,201</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-9,285, -7,117</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"4\">R² = 0.742; Adjusted R² = 0.742; AIC = 197,736; Statistic = 1,523; p-value = &lt;0.001; σ = 60,849</td>\n    </tr>\n  </tfoot>\n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"4\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span> CI = Confidence Interval</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(rs_mlr, \n          \"data/models/rs_mlr.rds\" ) \n```\n:::\n\n\n## Converting the sf data.frame to SpatialPointDataFrame\n\n### The training data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_sp <- as_Spatial(train_sf)\ntrain_sp\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatialPointsDataFrame \nfeatures    : 7950 \nextent      : 11597.31, 42623.63, 28217.39, 48741.06  (xmin, xmax, ymin, ymax)\ncrs         : +proj=tmerc +lat_0=1.36666666666667 +lon_0=103.833333333333 +k=1 +x_0=28001.642 +y_0=38744.572 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \nvariables   : 16\nnames       : RESALE_PRICE, FLOOR_AREA_SQM, STOREY_ORDER, REMAINING_LEASE_MTHS,          PROX_CBD,     PROX_ELDERLYCARE,        PROX_HAWKER,           PROX_MRT,          PROX_PARK,   PROX_GOOD_PRISCH,        PROX_MALL,     PROX_SUPERMARKET, WITHIN_350M_KINDERGARTEN, WITHIN_350M_CHILDCARE, WITHIN_350M_BUS, ... \nmin values  :       218000,             74,            1,                  555, 0.999393538715878, 1.98943787433087e-08, 0.0333358643817954, 0.0220407324774434, 0.0441643212802781, 0.0652540365486641,                0, 1.21715176356525e-07,                        0,                     0,               0, ... \nmax values  :      1186888,            126,           17,                 1164,  19.6500691667807,     3.30163731686804,   2.80329916478192,   2.13060636038504,   2.41313695915468,   10.6223726149914, 2.26056404492346,     1.57131703651196,                        7,                    20,              18, ... \n```\n\n\n:::\n:::\n\n\n### The test data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_sp <- test_sf %>%\n  as_Spatial()\ntest_sp\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatialPointsDataFrame \nfeatures    : 7951 \nextent      : 11597.31, 42623.63, 28287.8, 48741.06  (xmin, xmax, ymin, ymax)\ncrs         : +proj=tmerc +lat_0=1.36666666666667 +lon_0=103.833333333333 +k=1 +x_0=28001.642 +y_0=38744.572 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \nvariables   : 16\nnames       : RESALE_PRICE, FLOOR_AREA_SQM, STOREY_ORDER, REMAINING_LEASE_MTHS,         PROX_CBD,     PROX_ELDERLYCARE,        PROX_HAWKER,           PROX_MRT,          PROX_PARK,   PROX_GOOD_PRISCH,        PROX_MALL,     PROX_SUPERMARKET, WITHIN_350M_KINDERGARTEN, WITHIN_350M_CHILDCARE, WITHIN_350M_BUS, ... \nmin values  :       230888,             74,            1,                  546, 1.00583660772922, 3.34897933104965e-07, 0.0333358643817954, 0.0414043955932523, 0.0441643212802781, 0.0907500295577619,                0, 1.21715176356525e-07,                        0,                     0,               0, ... \nmax values  :      1088000,            138,           14,                 1151,  19.632402730488,     3.30163731686804,   2.86763031236184,   2.13060636038504,   2.41313695915468,   10.6169590126272, 2.27100643784442,     1.53786629004208,                        7,                    16,              18, ... \n```\n\n\n:::\n:::\n\n\n## Preparing Data for Predictive Modelling\n\n### Extracting coordinates data\n\nThe code chunk below extract the x,y coordinates of the full, training and test data sets.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoords <- st_coordinates(rs_sf)\ncoords_train <- st_coordinates(train_sf)\ncoords_test <- st_coordinates(test_sf)\n```\n:::\n\n\nBefore continue, we write all the output into rds for future used.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoords_train <- write_rds(coords_train, \"data/models/coords_train.rds\" )\ncoords_test <- write_rds(coords_test, \"data/models/coords_test.rds\" )\n```\n:::\n\n\n### Droping geometry field\n\nFirst, we will drop geometry column of the sf data.frame by using `st_drop_geometry()` of sf package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_df <- train_sf %>% \n  st_drop_geometry()\n```\n:::\n\n\n## Calibrating Predictive Model: Recursive Partitioning method\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\nrs_rp <- rpart(\n  formula = RESALE_PRICE ~ \n    FLOOR_AREA_SQM +\n    STOREY_ORDER +\n    REMAINING_LEASE_MTHS +\n    PROX_CBD + \n    PROX_ELDERLYCARE + \n    PROX_HAWKER +\n    PROX_MRT + \n    PROX_PARK + \n    PROX_GOOD_PRISCH +\n    PROX_MALL + \n    PROX_SUPERMARKET +\n    WITHIN_350M_KINDERGARTEN +\n    WITHIN_350M_CHILDCARE +\n    WITHIN_350M_BUS +\n    WITHIN_1KM_PRISCH,\n    data = train_df)\nrs_rp\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nn= 7950 \n\nnode), split, n, deviance, yval\n      * denotes terminal node\n\n 1) root 7950 1.139546e+14 433705.6  \n   2) PROX_CBD>=7.974483 6665 4.472144e+13 403736.0  \n     4) REMAINING_LEASE_MTHS< 1020.5 4228 1.573100e+13 370187.4  \n       8) PROX_GOOD_PRISCH>=3.629405 2271 3.851141e+12 340796.1 *\n       9) PROX_GOOD_PRISCH< 3.629405 1957 7.641480e+12 404294.6 *\n     5) REMAINING_LEASE_MTHS>=1020.5 2437 1.597594e+13 461940.1  \n      10) PROX_CBD>=10.40657 2331 9.762718e+12 451754.4  \n        20) PROX_GOOD_PRISCH>=4.866983 1123 2.801796e+12 423493.8 *\n        21) PROX_GOOD_PRISCH< 4.866983 1208 5.230246e+12 478026.4 *\n      11) PROX_CBD< 10.40657 106 6.532500e+11 685929.1 *\n   3) PROX_CBD< 7.974483 1285 3.219685e+13 589151.4  \n     6) REMAINING_LEASE_MTHS< 930.5 745 6.613365e+12 486637.6  \n      12) FLOOR_AREA_SQM< 98.5 451 2.446537e+12 442460.5 *\n      13) FLOOR_AREA_SQM>=98.5 294 1.936449e+12 554405.7 *\n     7) REMAINING_LEASE_MTHS>=930.5 540 6.952722e+12 730582.5  \n      14) REMAINING_LEASE_MTHS< 1071.5 314 2.461969e+12 676641.3 *\n      15) REMAINING_LEASE_MTHS>=1071.5 226 2.307737e+12 805527.4 *\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrpart.plot(rs_rp)\n```\n\n::: {.cell-output-display}\n![](In-class_Ex09-grf_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n## Calibrating Random Forest Model\n\nIn this section, you will learn how to calibrate a model to predict HDB resale price by using random forest function of [**ranger**](https://cran.r-project.org/web/packages/ranger/index.html) package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\nrs_rf <- ranger(formula = RESALE_PRICE ~ \n    FLOOR_AREA_SQM +\n    STOREY_ORDER +\n    REMAINING_LEASE_MTHS +\n    PROX_CBD + \n    PROX_ELDERLYCARE + \n    PROX_HAWKER +\n    PROX_MRT + \n    PROX_PARK + \n    PROX_GOOD_PRISCH +\n    PROX_MALL + \n    PROX_SUPERMARKET +\n    WITHIN_350M_KINDERGARTEN +\n    WITHIN_350M_CHILDCARE +\n    WITHIN_350M_BUS +\n    WITHIN_1KM_PRISCH,\n    data=train_df,\n    importance = \"impurity\")\nrs_rf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRanger result\n\nCall:\n ranger(formula = RESALE_PRICE ~ FLOOR_AREA_SQM + STOREY_ORDER +      REMAINING_LEASE_MTHS + PROX_CBD + PROX_ELDERLYCARE + PROX_HAWKER +      PROX_MRT + PROX_PARK + PROX_GOOD_PRISCH + PROX_MALL + PROX_SUPERMARKET +      WITHIN_350M_KINDERGARTEN + WITHIN_350M_CHILDCARE + WITHIN_350M_BUS +      WITHIN_1KM_PRISCH, data = train_df, importance = \"impurity\") \n\nType:                             Regression \nNumber of trees:                  500 \nSample size:                      7950 \nNumber of independent variables:  15 \nMtry:                             3 \nTarget node size:                 5 \nVariable importance mode:         impurity \nSplitrule:                        variance \nOOB prediction error (MSE):       738005688 \nR squared (OOB):                  0.9485198 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nvi <- as.data.frame(rs_rf$variable.importance)\nvi$variables <- rownames(vi)\nvi <- vi %>%\n  rename(vi = \"rs_rf$variable.importance\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = vi,\n       aes(x = vi, \n           y = reorder(variables, vi))) + \n  geom_bar(stat=\"identity\")\n```\n\n::: {.cell-output-display}\n![](In-class_Ex09-grf_files/figure-html/unnamed-chunk-28-1.png){width=672}\n:::\n:::\n\n\n## Calibrating Geographical Random Forest Model\n\nIn this section, you will learn how to calibrate a model to predict HDB resale price by using `grf()` of [**SpatialML**](https://cran.r-project.org/web/packages/ranger/index.html) package.\n\n### Calibrating using training data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrf_bw_adp <- grf.bw(\n  formula = RESALE_PRICE ~ \n    FLOOR_AREA_SQM +\n    STOREY_ORDER +\n    REMAINING_LEASE_MTHS +\n    PROX_CBD + \n    PROX_ELDERLYCARE + \n    PROX_HAWKER +\n    PROX_MRT + \n    PROX_PARK + \n    PROX_GOOD_PRISCH +\n    PROX_MALL + \n    PROX_SUPERMARKET +\n    WITHIN_350M_KINDERGARTEN +\n    WITHIN_350M_CHILDCARE +\n    WITHIN_350M_BUS +\n    WITHIN_1KM_PRISCH,\n    dataset = train_df,\n    kernel= \"adaptive\",\n    coords= coords_train,\n    bw.min = 25,\n    bw.max = 60,\n    step = 1,\n    nthreads = 16,\n    forest = FALSE,\n    weighted = TRUE)\n```\n:::\n\n\n::: callout-tip\nThe procedure above is very time consuming. It is a good practice to save the output and stop the running the code chunk in future\n:::\n\nThe code chunk below calibrate a geographic random forest model by using `grf()` of **SpatialML** package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\nrs_grf <- grf(formula = RESALE_PRICE ~ \n    FLOOR_AREA_SQM +\n    STOREY_ORDER +\n    REMAINING_LEASE_MTHS +\n    PROX_CBD + \n    PROX_ELDERLYCARE + \n    PROX_HAWKER +\n    PROX_MRT + \n    PROX_PARK + \n    PROX_MALL + \n    PROX_SUPERMARKET +\n    WITHIN_350M_KINDERGARTEN +\n    WITHIN_350M_CHILDCARE +\n    WITHIN_350M_BUS +\n    WITHIN_1KM_PRISCH,\n    dframe=train_df, \n    bw=55,\n    kernel=\"adaptive\",\n    coords=coords_train)\n```\n:::\n\n\n::: callout-tip\nThe procedure above is very time consuming. It is a good practice to save the output and stop the running the code chunk in future\n:::\n\nLet's save the model output by using the code chunk below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(rs_grf, \n          \"data/models/rs_grf.rds\")\n```\n:::\n\n\nThe code chunk below can be used to retrieve the save model in future.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrs_grf <- read_rds(\"data/models/rs_grf.rds\")\n```\n:::\n\n\n### Predicting by using test data\n\n#### Preparing the test data\n\nThe code chunk below will be used to combine the test data with its corresponding coordinates data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_df <- cbind(test_sf, coords_test) %>%\n  st_drop_geometry()\n```\n:::\n\n\n## Predicting with test data\n\nNext, `predict.grf()` of spatialML package will be used to predict the resale value by using the test data and gwRF_adaptive model calibrated earlier.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrf_pred <- predict.grf(rs_grf, \n                        test_df,\n                        x.var.name=\"X\",\n                        y.var.name=\"Y\", \n                        local.w=1,\n                        global.w=0)\n```\n:::\n\n\n::: callout-tip\nThe procedure above is very time consuming. It is a good practice to save the output and stop the running the code chunk in future\n:::\n\nBefore moving on, let us save the output into rds file for future use.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrf_pred <- write_rds(grf_pred, \n                      \"data/models/grf_pred.rds\")\n```\n:::\n\n\n### Saving predicted output of geographic random forest and preparing final data table\n\nThe output of the `predict.grf()` is a vector of predicted values. It is wiser to convert it into a data frame for further visualisation and analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrf_pred <- read_rds(\"data/models/grf_pred.rds\")\ngrf_pred_df <- as.data.frame(grf_pred)\n```\n:::\n\n\nIn the code chunk below, `cbind()` is used to append the predicted values onto test_df the\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_pred <- test_df %>%\n  select(RESALE_PRICE) %>% \n  cbind(grf_pred_df)\n```\n:::\n\n\n### Saving predicted output of random forest and preparing final data table\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrf_pred <- predict(rs_rf, test_df)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrf_pred_df <- as.data.frame(rf_pred$predictions) %>%\n  rename(rf_pred = \"rf_pred$predictions\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_pred <- cbind(test_pred, \n                   rf_pred_df)\n```\n:::\n\n\n### Saving predicted output of multiple linear regression and preparing final data table\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmlr_pred <- predict(rs_mlr, test_df)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmlr_pred_df <- as.data.frame(mlr_pred) %>%\n  rename(mlr_pred = \"mlr_pred\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_pred <- cbind(test_pred, \n                   mlr_pred_df)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(test_pred, \n          \"data/models/test_pred.rds\")\n```\n:::\n\n\n## Model Comparison\n\nThe root mean square error (RMSE) allows us to measure how far predicted values are from observed values in a regression analysis. In the code chunk below, rmse() of Metrics package is used to compute the RMSE.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nyardstick::rmse(test_pred, \n                RESALE_PRICE, \n                grf_pred)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 3\n  .metric .estimator .estimate\n  <chr>   <chr>          <dbl>\n1 rmse    standard      28745.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nyardstick::rmse(test_pred, \n                RESALE_PRICE, \n                rf_pred)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 3\n  .metric .estimator .estimate\n  <chr>   <chr>          <dbl>\n1 rmse    standard      28970.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nyardstick::rmse(test_pred, \n                RESALE_PRICE, \n                mlr_pred)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 3\n  .metric .estimator .estimate\n  <chr>   <chr>          <dbl>\n1 rmse    standard      61617.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmc <- test_pred %>%\n  pivot_longer(cols = c(2:4),\n               names_to = \"models\",\n               values_to = \"predicted\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmc %>% \n  group_by(models) %>%\n  yardstick::rmse(RESALE_PRICE, \n                  predicted)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 4\n  models   .metric .estimator .estimate\n  <chr>    <chr>   <chr>          <dbl>\n1 grf_pred rmse    standard      28745.\n2 mlr_pred rmse    standard      61617.\n3 rf_pred  rmse    standard      28970.\n```\n\n\n:::\n:::\n\n\n### Visualising the predicted values\n\nAlternatively, scatterplot can be used to visualise the actual resale price and the predicted resale price by using the code chunk below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = test_pred,\n       aes(x = grf_pred,\n           y = RESALE_PRICE)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](In-class_Ex09-grf_files/figure-html/unnamed-chunk-51-1.png){width=672}\n:::\n:::\n\n\n::: callout-note\nA better predictive model should have the scatter point close to the diagonal line. The scatter plot can be also used to detect if any outliers in the model.\n:::\n\nIn the code chunk below, `facet_grid()` of **ggplot** package is used to display the scatterplots next to each other.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = mc,\n       aes(x = predicted,\n           y = RESALE_PRICE)) +\n  geom_point() +\n  facet_grid(. ~ models)\n```\n\n::: {.cell-output-display}\n![](In-class_Ex09-grf_files/figure-html/unnamed-chunk-52-1.png){width=1152}\n:::\n:::\n",
    "supporting": [
      "In-class_Ex09-grf_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}